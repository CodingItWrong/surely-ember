<PaperCard as |card|>
  <card.title as |title|>
    <title.text as |text|>
      <text.headline data-test-todo-name>
        {{@todo.name}}
      </text.headline>
    </title.text>
  </card.title>
  {{#if this.isEditing}}
    <PaperForm @onSubmit={{this.handleSave}} as |form|>
      <card.content>
        <form.input
          @label="Todo"
          @value={{this.editedName}}
          @onChange={{action (mut this.editedName)}}
          @block={{true}}
          autocapitalize="true"
          data-test-todo-name-field
        />
        <PaperInput
          @type="date"
          @label="Defer Until Date"
          @value={{this.deferredUntil}}
          @onChange={{action (mut this.deferredUntil)}}
          @block={{true}}
        />
      </card.content>
      <card.actions>
        <PaperButton @onClick={{this.cancelEdit}}>
          Cancel
        </PaperButton>
        <form.submit-button
          @raised={{true}}
          @primary={{true}}
          data-test-save-button
        >
          {{paper-icon "save"}}
          Save
        </form.submit-button>
      </card.actions>
    </PaperForm>
  {{else}}
    <card.content>
      {{#if @todo.isDeleted}}
        <p>Deleted {{relative-datetime @todo.deletedAt}}</p>
      {{/if}}

      {{#if @todo.isCompleted}}
        {{#if @todo.isDeleted}}
          <p><small>Completed {{relative-datetime @todo.completedAt}}</small></p>
        {{else}}
          <p>Completed {{relative-datetime @todo.completedAt}}</p>
        {{/if}}
      {{/if}}

      {{#if @todo.deferredUntil}}
        <p data-test-deferred-until>
          {{#if (or @todo.isDeleted @todo.isCompleted)}}
            <small>Deferred until {{relative-date @todo.deferredUntil}}</small>
          {{else}}
            Deferred until {{relative-date @todo.deferredUntil}}
          {{/if}}
        </p>
      {{/if}}

      {{#if (or @todo.isDeleted @todo.isCompleted @todo.deferredUntil)}}
        <p><small>Created {{relative-datetime @todo.createdAt}}</small></p>
      {{else}}
        <p>Created {{relative-datetime @todo.createdAt}}</p>
      {{/if}}

      {{#if (and @todo.isDeleted @todo.isCompleted)}}
        <p><small>Completed {{relative-datetime @todo.completedAt}}</small></p>
      {{/if}}
      <PaperButton
        @onClick={{this.edit}}
        data-test-edit-button
      >
        Edit
      </PaperButton>
    </card.content>
    <card.actions class="app-button-container">
      {{#if (eq this.buttonSet 'actions')}}
        {{#if @todo.isDeleted}}
          <PaperButton
            @raised={{true}}
            @primary={{true}}
            @onClick={{this.undelete}}
          >
            {{paper-icon "restore_from_trash"}}
            Undelete
          </PaperButton>
        {{else}}
          <PaperButton @onClick={{this.delete}}>
            Delete
          </PaperButton>
          {{#if @todo.isCompleted}}
            <PaperButton
              @raised={{true}}
              @primary={{true}}
              @onClick={{this.uncomplete}}
            >
              {{paper-icon "check_box_outline_blank"}}
              Uncomplete
            </PaperButton>
          {{else}}
            <PaperButton
              @onClick={{this.defer}}
              data-test-defer-button
            >
              Defer
            </PaperButton>
            <PaperButton
              @onClick={{this.complete}}
              @raised={{true}}
              @primary={{true}}
            >
              {{paper-icon "check_box"}}
              Complete
            </PaperButton>
          {{/if}}
        {{/if}}
      {{else if (eq this.buttonSet 'defer')}}
        <PaperButton @onClick={{this.cancelDefer}}>
          Cancel
        </PaperButton>
        <PaperButton
          @onClick={{this.deferOneDay}}
          data-test-defer-one-day-button
        >
          Defer One Day
        </PaperButton>
        <PaperButton @onClick={{this.deferUntilDate}}>
          Defer Until Date
        </PaperButton>
      {{else if (eq this.buttonSet 'defer_until_date')}}
        <PaperForm
          @onSubmit={{this.saveEnteredDeferredDate}}
          as |form|
        >
          <PaperInput
            @type="date"
            @label="Defer Until Date"
            @value={{this.deferredUntil}}
            @onChange={{action (mut this.deferredUntil)}}
          />
          <PaperButton @onClick={{this.cancelDefer}}>
            Cancel
          </PaperButton>
          <form.submit-button
            @raised={{true}}
            @primary={{true}}>
            {{paper-icon "calendar_today"}}
            Defer
          </form.submit-button>
        </PaperForm>
      {{/if}}
    </card.actions>
  {{/if}}
</PaperCard>
